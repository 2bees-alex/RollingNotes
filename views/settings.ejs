<!--*************************************************
UI for the settings panel for rolling notes. Uses angular model, wix ui lib & html.
Includes design settings, template settings and the manage notes screen.
*************************************************-->
<!DOCTYPE html>
<html ng-app="settingsApp">
<head lang="en">
    <meta charset="UTF-8">
    <title>Settings</title>
    <link rel="stylesheet" href="/javascripts/bower_components/wix-ui-lib2/ui-lib.min.css"/>
    <link rel="stylesheet" href="/stylesheets/settings-styles.css"/>
</head>
<!-- set angular controller-->
<body wix-ui ng-controller="settingsController as ctrl">
    <div class="overlay-lock">
        <a><div class="overlay-gray" ng-click="ctrl.previewTransition()"></div></a>
        <!-- header above settings options, visible above all settings
             includes button for manage notes screen-->
        <header class="box">
            <div class="logo">
                <img width="86" src="/images/settings-logo.png" alt="logo"/>
            </div>
            <div class="top-right-header">
                <p>This is a sample Settings view for widgets and pages created with
                    Wix's 3rd Party SDK, compatible with Wix's product requirements.
                </p>
                <!-- example of wix ui lib component (button) working with angular directive (ng-click) -->
                <button class="uilib-btn manage-btn" ng-click="ctrl.showManageNotes()">Manage notes</button>
            </div>
        </header>
        <!-- settings tabs: Design and Transition settings-->
        <div class="feature" wix-ctrl="Tabs" wix-options="{value:0}"  style="margin: 0px">
            <ul>
                <li data-tab="tab0"><div>Design</div></li>
                <li data-tab="tab1" class="trans"><div>Transition</div></li>
            </ul>
            <!--All Tab Content-->
            <div class="tab-content">
                <!--First Tab (Design) Content-->
                <div data-tab="tab0" class="tab-pane">
                    <ui class="list uilib-text">
                         <div class = "settings-group">
                            <li class="li-group">
                                <!-- Template skins, using wix ui lib with custom images in CSS -->
                                <div class="skins-group" wix-model="template" wix-ctrl="ButtonGroup" wix-options="{value:'{{ctrl.settings.design.template}}'}">
                                    <button value="defaultNote"></button>
                                    <button value="spiralNote"></button>
                                    <button value="postitNote"></button>
                                    <button value="chalkboardNote"></button>
                                </div>
                                <button id="resetTemplateButton" class="uilib-btn btn-small" ng-click="ctrl.resetTemplate()">Reset</button>
                            </li>
                        </div>
                        <!-- Custom design and text settings using Wix ui lib components and wix ui models -->
                        <div class="lower-settings">
                            <!-- font color and font style -->
                            <li class="li-group" wix-label="Text">
                                <!-- example of setting initial value of design option to existing database model with angular -->
                                <div wix-model="color" wix-ctrl="ColorPicker"  wix-options="{startWithColor:'color-13', value:'{{ctrl.settings.design.text.color || '#ff7766'}}' }"></div>
                                <!-- example of using a wix-param, linked to the html with inline styles at the top of widget.ejs-->
                                <div wix-param="font" wix-ctrl="FontStylePicker"></div>
                            </li>
                            <!-- background color and opacity-->
                            <li class="li-group" wix-label="Background Color">
                                <div wix-model="bcolorWOpacity" wix-ctrl="ColorPickerWithOpacity"
                                     wix-options="{startWithColor: '{{ctrl.settings.design.background.color || '#ffffff'}}', startWithOpacity:'{{(ctrl.settings.design.background.opacity*100) || '100'}}'}"></div>
                                <div wix-model="bOpacitySpinner" wix-ctrl="Spinner" wix-options="{minValue: 0, maxValue:100, value:'{{100 *ctrl.settings.design.background.opacity || '100'}}'}"></div>
                            </li>
                            <!-- hover color toggle, color, and opacity-->
                            <li class="li-group">
                                <div class="hover-check" wix-model="hoverCheckbox" wix-ctrl="Checkbox" wix-options="{preLabel:'', checked:{{ctrl.settings.design.hover.selected || 'true'}}}"></div>
                                <span wix-label="Hover Color"></span>
                                <div wix-model="hcolorWOpacity" wix-ctrl="ColorPickerWithOpacity" wix-options="{startWithColor: '{{ctrl.settings.design.hover.color || '#ffffff'}}', startWithOpacity:'{{('' + ctrl.settings.design.hover.opacity*100) || '100'}}'}"></div>
                                <div wix-model="hOpacitySlider" wix-ctrl="Spinner" wix-options="{minValue: 0, maxValue:100,  value:'{{100 *ctrl.settings.design.hover.opacity || '100'}}' }"></div>
                            </li>
                            <!-- border color and size -->
                            <li class="li-group borderGroup" wix-label="Border">
                                <div wix-model="borderColor" wix-ctrl="ColorPicker"  wix-options="{startWithColor:'#000000', value:'{{ctrl.settings.design.border.color || '#000000'}}'}" ></div>
                                <span class="width-slider-label">Width</span>
                                <div  wix-model="borderWidth" wix-ctrl="Slider" wix-options="{ maxValue:20, preLabel:'0', postLabel:'20', value:'{{ctrl.settings.design.border.width}}'}"></div>
                                <div class="borderSpinner"wix-model="borderWidth" wix-ctrl="Spinner" wix-options="{minValue: 0, maxValue:20, value:'{{ctrl.settings.border.width}}' }"></div>
                            </li>
                            <!-- border radius -->
                            <li class="li-group cornerGroup" wix-label="Roundness">
                                <span class="radius-slider-label">Radius</span>
                                <div  wix-model="radius" wix-ctrl="Slider" wix-options="{ maxValue:50, preLabel:'0', postLabel:'50', value:'{{ctrl.settings.design.border.radius}}'}"></div>
                                <div class="cornerSpinner" wix-model="radius" wix-ctrl="Spinner" wix-options="{minValue: 0, maxValue:50 }"></div>
                            </li>
                        </div>
                    </ui>
                </div>
                <!--Second Tab (Transition Tab) Content-->
                <div data-tab="tab1" class="tab-pane">
                    <ui class="list uilib-text">
                        <div class = "settings-group">
                            <li class="li-group">
                                <!-- Transition options -->
                                <div class="dur-group" wix-model="transition" wix-ctrl="ButtonGroup" wix-options="{value: '{{ctrl.settings.transition.effect}}'}">
                                    <div class="transitionButtonBlock">
                                        <button value="fade"></button>
                                        <p>Fade</p>
                                    </div>
                                    <div class="transitionButtonBlock">
                                        <button value="horizontal"></button>
                                        <p>Horizontal</p>
                                    </div>
                                    <div class="transitionButtonBlock">
                                        <button value="vertical"></button>
                                        <p>Vertical</p>
                                    </div>
                                    <div class="transitionButtonBlock">
                                        <button value="zoom"></button>
                                        <p>Zoom</p>
                                    </div>
                                </div>
                                <!-- preview transition button, locks other button while in preview -->
                                <button id="previewTransitionButton" class="uilib-btn btn-small" ng-click="ctrl.previewTransition()"> Preview</button>

                            </li>
                        </div>
                        <div class="lower-settings">
                            <!-- Duration each slide is shown before transitioning -->
                            <li class="li-group durationGroup" wix-label="Slide Duration (seconds)">
                                <div  wix-model="duration" wix-ctrl="Slider" wix-options="{ minValue: 2, maxValue:10, preLabel:'2', postLabel:'10', value:'{{ctrl.settings.transition.duration}}'}"></div>
                                <div class="durationSpinner" wix-model="duration" wix-ctrl="Spinner" wix-options="{minValue: 2, maxValue:10 }"></div>
                            </li>
                        </div>
                    </ui>
                </div>
            </div>
            <!-- Manage notes screen, where user adds and edits notes, toggles visibility, adds links and deletes notes -->
            <div id="manage-notes" class="manage-notes-screen hidden-manage-notes">
                <div id="manage-notes-header">
                   <a class="back-to-settings-button" ng-click="ctrl.hideManageNotes()" href="#"> < Back to Settings</a>
                   <button class="uilib-btn add-note-btn" ng-click="ctrl.addNote()" ng-class="{'max-note-btn' : ctrl.settings.notes.length >= 50}">+ Add a note</button>
                    <p class="max-notes-msg" ng-show="ctrl.settings.notes.length >= 50">50 note maximum</p>
                </div>
                <!-- link popup becomes visible when user clicks add link button -->
                <div id="link-popup">
                    <div class="link-popup-header">
                        Link
                        <div class="close-link-container">
                            <a class="icon-close" ng-click="ctrl.closeLinkPopup()"></a>
                        </div>
                    </div>
                    <hr class="horizontal">
                    <div class="learn-more">
                        <p>Choose type of link</p>
                        <a ng-click="ctrl.backToOptions()">Learn More</a>
                    </div>
                    <div class="link-options">
                        <div class="option web-link">
                            Insert a web address:
                            <input class="web-text input" type="text" ng-model="ctrl.noteForLink.webLink"
                                   placeholder="E.g http://www.wix.com" http-prefix>
                            <input class="radios" type="radio" ng-model="ctrl.noteForLink.link.targetVal" value="0"> Open in new window <br>
                            <input class="radios" type="radio" ng-model="ctrl.noteForLink.link.targetVal" value="1"> Open in same window
                        </div>
                        <div class="option page-link">
                            Select Page:
                            <select ng-model="ctrl.noteForLink.pageLink" ng-options="titles.toString() for titles in ctrl.settings.pages"></select>
                        </div>
                        <div class="option email-link">
                            Insert an email address <br>
                            <input class="email-text input email" type="text" ng-model="ctrl.noteForLink.emailLink" placeholder="E.g info@wix.com">
                            Insert a subject <br>
                            <input class="email-text input subject-text" type="text" ng-model="ctrl.noteForLink.link.subject" placeholder="E.g Request Information">
                        </div>
                        <div class="option doc-link">
                            <!--{{ctrl.noteForLink.link.display || "No Document Selected"}}-->
                            {{ctrl.getDocDislay()}}
                            <br>
                            <button class="uilib-btn btn-large" ng-click="ctrl.docLink()">
                                <span>Upload</span>
                            </button>
                        </div>
                        <button class="uilib-btn btn-secondary link-btn" ng-click="ctrl.showLinkContent(1)">Web Address</button>
                        <button class="uilib-btn btn-secondary link-btn" ng-click="ctrl.showLinkContent(2)">Page</button>
                        <button class="uilib-btn btn-secondary link-btn" ng-click="ctrl.showLinkContent(3)">Email</button>
                        <button class="uilib-btn btn-secondary link-btn" ng-click="ctrl.showLinkContent(4)">Document</button>
                        <a class="remove-link" ng-click="ctrl.removeLink()">Remove link</a>
                    </div>
                    <button class="uilib-btn btn-large submit-link-btn" ng-click="ctrl.setLink()">OK</button>
                </div>
                <!-- List of all existing notes, added drag and drop functionality, updated dynamically with angular ng-repeat directive -->
                <ul ui:sortable ng-model="ctrl.settings.notes" id="manage-notes-content" class="box">
                    <li ng-repeat="note in ctrl.settings.notes" class="note-container">
                        <div class="content-row">
                            <div class="drag-container">
                                <a><img class="drag-img" src="/images/drag-icon.png" /></a>
                            </div>
                            <div class="note-text-container">
                                <textarea ng-model="note.msg" ng-blur="ctrl.blur()" ng-trim="false" ng-keydown="ctrl.textLength($event, note.msg)"
                                        rows="0" class="note-text" ng-class="{'unwatched-note': note.visibility == false}" type="text" maxlength="140"
                                        placeholder="This is a note. Click to edit"></textarea>
                                <div class="character-count-normal">{{note.msg.length}}/140</div>
                            </div>
                            <div class="edit-icons-container">
                                <!--<a class="icon-edit" ng-click="ctrl.focusText($event)"></a>-->
                                <a class="icon-edit" ng-click="ctrl.editNoteButton($event, $index)"></a>
                                <a ng-click="ctrl.deleteNote(ctrl.settings.notes, $index)"><img id="trash-icon" src="/images/trash-icon.png" /></a>
                                <a ng-click="ctrl.toggleWatch($event, $index)" ng-class="{'icon-watch' : note.visibility == true, 'icon-unwatch' : note.visibility == false}"></a>
                            </div>
                        </div>
                        <div class="link-container">

                                <a ng-click="ctrl.showLinkPopup(note)"><img class="link-icon" src="/images/link-icon.png"/></a>
                                <a ng-click="ctrl.showLinkPopup(note)">{{note.link.display || "Add a link" }}</a>
                        </div>
                    </li>
                </ul>
            </div>
        </div>


        <script type="text/javascript" src="javascripts/bower_components/jquery/dist/jquery.min.js"></script>
        <script type="text/javascript" src="javascripts/bower_components/jqueryui/jquery-ui.min.js"></script>
        <script type="text/javascript" src="//sslstatic.wix.com/services/js-sdk/1.33.0/js/Wix.js"></script>
        <script type="text/javascript" src="javascripts/bower_components/angular/angular.min.js"></script>
        <script type="text/javascript" src="javascripts/bower_components/angular-ui-sortable/sortable.min.js"></script>
        <script type="text/javascript" src="/javascripts/bower_components/wix-ui-lib2/ui-lib.js"></script>
        <script type="text/javascript" src="/javascripts/bower_components/angular-mailto/angular-mailto.js"></script>
        <script type="text/javascript" src="/javascripts/bower_components/visibilityjs/lib/visibility.core.js"></script>
        <script type="text/javascript" src="/javascripts/bower_components/visibilityjs/lib/visibility.timers.js"></script>
        <script type="text/javascript" src="/javascripts/bower_components/deep-diff/releases/deep-diff-0.2.0.min.js"></script>
        <script type="text/javascript" src="/javascripts/settings-bundle.js"></script>

        <!-- get global settings JSON  from database -->
        <script type="text/javascript">
            var settings = <%- settings %>;
        </script>

        <!-- initilaize wix settings ui -->
        <script type="text/javascript">
            $(document).ready(function () {

                Wix.UI.initialize({
                    numOfImages: 100,
                    isIconShown: true,
                    imageVisibility: 'show',
                    imagesToSync: 0,
                    imageLink: false
                });

                console.log('do we get here?');
                $('.manage-notes-screen').css('top','0px');

            });
        </script>
    </div>
</body>
</html>


